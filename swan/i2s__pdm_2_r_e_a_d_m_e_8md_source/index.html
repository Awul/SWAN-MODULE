<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="SWAN Team" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>File README.md - SWAN Module Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "File README.md";
        var mkdocs_page_input_path = "swan\\i2s__pdm_2_r_e_a_d_m_e_8md_source.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> SWAN Module Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/build/">Build & Flash</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../modules/">Modules</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/architecture/">Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/style/">Coding Style</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/license/">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">SWAN Module Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">File README.md</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/Awul/SWAN-MODULE/edit/master/docs/swan/i2s__pdm_2_r_e_a_d_m_e_8md_source.md">Edit on Awul/SWAN-MODULE</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="file-readmemd">File README.md</h1>
<p><a href="../files/"><strong>File List</strong></a> <strong>&gt;</strong> <a href="../i2s__pdm_2_r_e_a_d_m_e_8md/"><strong>README.md</strong></a></p>
<p><a href="../i2s__pdm_2_r_e_a_d_m_e_8md/">Go to the documentation of this file</a></p>
<pre><code class="language-Markdown">| Supported Targets | ESP32 | ESP32-C3 | ESP32-C5 | ESP32-C6 | ESP32-C61 | ESP32-H2 | ESP32-P4 | ESP32-S3 |
| ----------------- | ----- | -------- | -------- | -------- | --------- | -------- | -------- | -------- |

# I2S Basic PDM Mode Example

(See the README.md file in the upper level 'examples' directory for more information about examples.)

This example is going to show how to use the PDM TX and RX mode.

## How to Use Example

### Hardware Required

#### General

* A development board with any supported Espressif SOC chip (see `Supported Targets` table above)
* A USB cable for power supply and programming

#### PDM RX

* For non-ESP32-S3 SoC, a PDM microphone whose `sel` pin is supposed to be pulled down, and connecting its `clk` pin to `EXAMPLE_PDM_RX_CLK_IO`, `data` pin to `EXAMPLE_PDM_RX_DIN_IO`.

</code></pre>
<p>┌───────────────────────┐               ┌──────────────────┐
│          ESP          │               │   PDM microphone │
│                       │   PDM clock   │                  │
│ EXAMPLE_PDM_RX_CLK_IO ├──────────────►│ CLK              │
│                       │   PDM data    │                  │
│ EXAMPLE_PDM_RX_DIN_IO │◄──────────────┤ DATA             │
│                       │               │                  │
│                       │         ┌─────┤ SEL              │
│                       │         │     │                  │
│                   GND ├─────────┴─────┤ GND              │
│                       │               │                  │
│                   VCC ├───────────────┤ VCC              │
└───────────────────────┘               └──────────────────┘</p>
<pre><code class="language-Markdown">
* For ESP32-S3 SoC, this example shows how to support 8 PDM microphones, in this case, the connection can be:

</code></pre>
<p>┌──────────────────┐                        ┌─────────────────────────┐                        ┌──────────────────┐
│  PDM microphone3 │                        │            ESP          │                        │  PDM microphone1 │
│                  │      PDM clock         │                         │          PDM clock     │                  │
│             CLK  │◄───┬───────────────────┤  EXAMPLE_PDM_RX_CLK_IO  ├───────────────────┬───►│ CLK              │
│                  │    │                   │                         │                   │    │                  │
│             DATA ├────┼────┐              │  EXAMPLE_PDM_RX_DIN_IO  │◄─────────────┬────┼────┤ DATA             │
│                  │    │    │              │                         │              │    │    │                  │
│             SEL  ├────┼────┼─────────┐    │                         │    ┌─────────┼────┼────┤ SEL              │
│                  │    │    │         │    │                         │    │         │    │    │                  │
│             GND  ├────┼────┼────┐    │    │                         │    │    ┌────┼────┼────┤ GND              │
│                  │    │    │    │    │    │                         │    │    │    │    │    │                  │
│             VCC  ├────┼────┼────┼────┤    │                         │    ├────┼────┼────┼────┤ VCC              │
└──────────────────┘    │    │    │    │    │                         │    │    │    │    │    └──────────────────┘
                        │    │    │    │    │                         │    │    │    │    │
┌──────────────────┐    │    │    │    │    │                         │    │    │    │    │    ┌──────────────────┐
│  PDM microphone4 │    │    │    │    │    │                         │    │    │    │    │    │  PDM microphone2 │
│                  │    │    │    │    │    │                         │    │    │    │    │    │                  │
│             CLK  │◄───┤    │    │    │    │                         │    │    │    │    ├───►│ CLK              │
│                  │    │    │    │    │    │                         │    │    │    │    │    │                  │
│             DATA ├────┼────┴────┼────┼───►│ EXAMPLE_PDM_RX_DIN1_IO  │    │    │    └────┼────┤ DATA             │
│                  │    │         │    │    │                         │    │    │         │    │                  │
│             SEL  ├────┼─────────┤    │    │                         │    │    ├─────────┼────┤ SEL              │
│                  │    │         │    │    │                         │    │    │         │    │                  │
│             GND  ├────┼─────────┤    │    │                         │    │    ├─────────┼────┤ GND              │
│                  │    │         │    │    │                         │    │    │         │    │                  │
│             VCC  ├────┼─────────┼────┤    │                         │    ├────┼─────────┼────┤ VCC              │
└──────────────────┘    │         │    │    │                         │    │    │         │    └──────────────────┘
                        │         │    │    │                         │    │    │         │
┌──────────────────┐    │         │    │    │                         │    │    │         │    ┌──────────────────┐
│  PDM microphone7 │    │         │    │    │                         │    │    │         │    │  PDM microphone5 │
│                  │    │         │    │    │                         │    │    │         │    │                  │
│             CLK  │◄───┤         │    │    │                         │    │    │         ├───►│ CLK              │
│                  │    │         │    │    │                         │    │    │         │    │                  │
│             DATA ├────┼────┐    │    │    │ EXAMPLE_PDM_RX_DIN2_IO  │◄───┼────┼────┬────┼────┤ DATA             │
│                  │    │    │    │    │    │                         │    │    │    │    │    │                  │
│             SEL  ├────┼────┼────┼────┤    │                         │    ├────┼────┼────┼────┤ SEL              │
│                  │    │    │    │    │    │                         │    │    │    │    │    │                  │
│             GND  ├────┼────┼────┤    │    │                         │    │    ├────┼────┼────┤ GND              │
│                  │    │    │    │    │    │                         │    │    │    │    │    │                  │
│             VCC  ├────┼────┼────┼────┤    │                         │    ├────┼────┼────┼────┤ VCC              │
└──────────────────┘    │    │    │    │    │                         │    │    │    │    │    └──────────────────┘
                        │    │    │    │    │                         │    │    │    │    │
┌──────────────────┐    │    │    │    │    │                         │    │    │    │    │    ┌──────────────────┐
│  PDM microphone8 │    │    │    │    │    │                         │    │    │    │    │    │  PDM microphone6 │
│                  │    │    │    │    │    │                         │    │    │    │    │    │                  │
│             CLK  │◄───┘    │    │    │    │                         │    │    │    │    └───►│ CLK              │
│                  │         │    │    │    │                         │    │    │    │         │                  │
│             DATA ├─────────┴────┼────┼───►│ EXAMPLE_PDM_RX_DIN3_IO  │    │    │    └─────────┤ DATA             │
│                  │              │    │    │                         │    │    │              │                  │
│             SEL  ├──────────────┤    │    │                         │    │    ├──────────────┤ SEL              │
│                  │              │    │    │                         │    │    │              │                  │
│             GND  ├──────────────┴────┼────┤           GND           ├────┼────┴──────────────┤ GND              │
│                  │                   │    │                         │    │                   │                  │
│             VCC  ├───────────────────┴────┤           VCC           ├────┴───────────────────┤ VCC              │
└──────────────────┘                        └─────────────────────────┘                        └──────────────────┘</p>
<pre><code class="language-Markdown">
#### PDM TX

* An earphone or a speaker
* An audio power amplifier that can input PDM signal. If the power amplifier can only receive the analog signal without PDM clock (i.e. DAC line mode, otherwise codec line mode), a low-pass passive or active filter is required to restore the PDM data wave into analog signal, before it is transmitted to the power amplifier.

**MAX98358 (codec case)**

Please refer to the [Datasheet of MAX98358](https://datasheets.maximintegrated.com/en/ds/MAX98358.pdf) for more details.

</code></pre>
<p>┌────────────────────────┐               ┌───────────────┐
│          ESP           │               │   MAX 98358   │
│                        │   PDM clock   │               │
│  EXAMPLE_PDM_TX_CLK_IO ├──────────────►│ CLK           │   ┌─────────┐
│                        │   PDM data    │               │   │ Speaker │
│ EXAMPLE_PDM_TX_DOUT_IO ├──────────────►│ DATA     OUTP ├───┤         │
│                        │               │               │   │         │
│                        │         ┌─────┤ SD_MODE  OUTN ├───┤         │
│                        │         │     │               │   │         │
│                    VCC ├─────────┴─────┤ VCC           │   └─────────┘
│                        │               │               │
│                    GND ├───────────────┤ GND           │
└────────────────────────┘               └───────────────┘</p>
<pre><code class="language-Markdown">
**NS4150 (dac case)**

Please refer to the NS4150 datasheet for more details.

</code></pre>
<p>┌────────────────────────┐                              ┌───────────────┐
│          ESP           │                              │    NS 4150    │
│                        │                              │               │
│  EXAMPLE_PDM_TX_CLK_IO │(No need to connect)          │ INN           │   ┌─────────┐
│                        │PDM data┌────────────────┐    │               │   │ Speaker │
│ EXAMPLE_PDM_TX_DOUT_IO ├────────┤ Low-pass Filter├───►│ INP       VoP ├───┤         │
│                        │        └────────────────┘    │               │   │         │
│                        │                          ┌───┤ CTRL      VoN ├───┤         │
│                        │                          │   │               │   │         │
│                    VCC ├──────────────────────────┴───┤ VCC           │   └─────────┘
│                        │                              │               │
│                    GND ├──────────────────────────────┤ GND           │
└────────────────────────┘                              └───────────────┘</p>
<pre><code class="language-Markdown">
### Configure the Project

PDM can only works in simplex mode, you can select the PDM direction in the menu config, or just setting the macro `EXAMPLE_PDM_DIR` directly. Setting it to `EXAMPLE_PDM_TX` or `EXAMPLE_PDM_RX` can choose the PDM direction of this example. But currently ESP32-C3 does not support PDM RX mode.

### Build and Flash

Build the project and flash it to the board, then run monitor tool to view serial output:

</code></pre>
<p>idf.py -p PORT build flash monitor</p>
<pre><code class="language-Markdown">
(To exit the serial monitor, type ``Ctrl-]``.)

See the Getting Started Guide for full steps to configure and use ESP-IDF to build projects.

## Example Output

### PDM TX

While `EXAMPLE_PDM_DIR` is set to `EXAMPLE_PDM_TX`, then you can see the following log:

</code></pre>
<h2 id="i2s-pdm-tx-example-start">I2S PDM TX example start</h2>
<p>D (284) i2s_common: tx channel is registered on I2S0 successfully
D (294) i2s_common: DMA malloc info: dma_desc_num = 6, dma_desc_buf_size = dma_frame_num * slot_num * data_bit_width = 500
D (304) i2s_pdm: Clock division info: [sclk] 160000000 Hz [mdiv] 3 [mclk] 49152000 Hz [bdiv] 8 [bclk] 6144000 Hz
D (314) i2s_pdm: The tx channel on I2S0 has been initialized to PDM TX mode successfully
D (324) i2s_common: i2s tx channel enabled
Playing bass <code>twinkle twinkle little star</code>
Playing alto <code>twinkle twinkle little star</code>
Playing treble <code>twinkle twinkle little star</code>
...</p>
<pre><code class="language-Markdown">
You can hear the audio 'twinkle twinkle little star' in three tones if you connect a speaker to it.

### PDM RX

While `EXAMPLE_PDM_DIR` is set to `EXAMPLE_PDM_RX`, but without connecting a PDM microphone, then you can see the following log:

</code></pre>
<h2 id="i2s-pdm-rx-example-start">I2S PDM RX example start</h2>
<p>D (10) i2s_common: rx channel is registered on I2S0 successfully
D (10) i2s_common: DMA malloc info: dma_desc_num = 6, dma_desc_buf_size = dma_frame_num * slot_num * data_bit_width = 500
D (20) i2s_common: i2s rx channel enabled
Read Task: i2s read 2048 bytes</p>
<hr />
<p>[0] -6595 [1] 0 [2] -29199 [3] -32768
[4] -30203 [5] -32156 [6] -30704 [7] -31348</p>
<h2 id="read-task-i2s-read-2048-bytes">Read Task: i2s read 2048 bytes</h2>
<p>[0] -30935 [1] -30935 [2] -30935 [3] -30935
[4] -30935 [5] -30935 [6] -30935 [7] -30935</p>
<h2 id="read-task-i2s-read-2048-bytes_1">Read Task: i2s read 2048 bytes</h2>
<p>[0] -30935 [1] -30935 [2] -30935 [3] -30935
[4] -30935 [5] -30935 [6] -30935 [7] -30935</p>
<pre><code class="language-Markdown">
And only if you connect a PDM microphone, you can see the data changes:

</code></pre>
<h2 id="i2s-pdm-rx-example-start_1">I2S PDM RX example start</h2>
<p>D (10) i2s_common: rx channel is registered on I2S0 successfully
D (10) i2s_common: DMA malloc info: dma_desc_num = 6, dma_desc_buf_size = dma_frame_num * slot_num * data_bit_width = 500
D (20) i2s_common: i2s rx channel enabled
Read Task: i2s read 2048 bytes</p>
<hr />
<p>[0] -3181 [1] 0 [2] -7194 [3] -24288
[4] -777 [5] 3650 [6] 109 [7] 571</p>
<h2 id="read-task-i2s-read-2048-bytes_2">Read Task: i2s read 2048 bytes</h2>
<p>[0] 2391 [1] 2378 [2] 2397 [3] 2385
[4] 2399 [5] 2375 [6] 2401 [7] 2389</p>
<pre><code class="language-Markdown">
## Troubleshooting

For any technical queries, please open an [issue](https://github.com/espressif/esp-idf/issues) on GitHub. We will get back to you soon.
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/Awul/SWAN-MODULE" class="fa fa-code-fork" style="color: #fcfcfc"> Awul/SWAN-MODULE</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
